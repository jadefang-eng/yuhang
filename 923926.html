<!DOCTYPE html><html lang="zh-CN"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人员排班表 - 可编辑版</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #fafafa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-weight: normal;
        }
        
        /* 操作按钮区域 */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-family: inherit;
            transition: background-color 0.3s;
        }
        .btn-reset {
            background-color: #ff9800;
            color: white;
        }
        .btn-reset:hover {
            background-color: #f57c00;
        }
        .btn-export {
            background-color: #2196f3;
            color: white;
        }
        .btn-export:hover {
            background-color: #1976d2;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #e0e0e0;
            padding: 10px 8px;
            text-align: center;
            white-space: nowrap;
            position: relative;
        }
        th {
            background-color: #f8f9fa;
            color: #333;
            font-weight: bold;
            font-size: 15px;
        }
        .name {
            background-color: #e8eaf6;
            color: #3f51b5;
            font-weight: bold;
            width: 70px;
            font-size: 15px;
            letter-spacing: 1px;
        }
        
        /* 可编辑单元格样式 */
        .editable {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .editable:hover {
            background-color: #f0f9ff !important;
            box-shadow: inset 0 0 0 2px #3b82f6;
        }
        
        /* 编辑输入框样式 */
        .edit-input {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            text-align: center;
            font-size: 14px;
            font-family: inherit;
            box-shadow: inset 0 0 0 2px #3b82f6;
            border-radius: 4px;
            outline: none;
            position: absolute;
            top: 0;
            left: 0;
            padding: 10px 8px;
            box-sizing: border-box;
            resize: none;
        }
        
        /* 简洁的班次颜色 */
        .门 { background-color: #e3f2fd; color: #1976d2; }
        .库 { background-color: #f5f5f5; color: #424242; }
        .静 { background-color: #e8eaf6; color: #5e35b1; }
        .病 { background-color: #fff3e0; color: #f57c00; }
        .机 { background-color: #f1f8e9; color: #689f38; }
        .门库混合 { background-color: #e3f2fd; color: #1976d2; }
        .休 { background-color: #fef3c7; color: #d97706; }
        .换 { background-color: #f3e8ff; color: #7c3aed; }
        
        /* 预约休息行样式 */
        .rest-row {
            background-color: #f9f9f9;
            border-top: 2px solid #ddd;
        }
        .rest-label {
            background-color: #f0f0f0;
            color: #666;
            font-weight: bold;
            font-size: 13px;
            font-style: italic;
        }
        
        /* 确认对话框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 300px;
        }
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .modal-message {
            font-size: 14px;
            margin-bottom: 25px;
            color: #666;
            line-height: 1.4;
        }
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }
        .btn-primary:hover {
            background-color: #45a049;
        }
        .btn-secondary {
            background-color: #f44336;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #da190b;
        }
        
        /* 状态提示 */
        .status {
            text-align: center;
            color: #4CAF50;
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        /* 提示信息 */
        .tip {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 15px;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; margin: 10px; }
            th, td { padding: 8px 6px; font-size: 13px; }
            .name { font-size: 14px; }
            .edit-input { font-size: 13px; padding: 8px 6px; }
            .modal-content { 
                min-width: 280px; 
                padding: 20px; 
                margin: 20px;
            }
            .modal-buttons { 
                flex-direction: column; 
                gap: 10px;
            }
            .controls { 
                flex-direction: column; 
                align-items: center;
                gap: 10px;
            }
        }
    </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.bd4eeeb8e8e02052ee92.js"></script></head>
<body>
    <div class="container">
        <h1>人员排班表 - 可编辑版</h1>
        
        <div class="controls">
            <button class="control-btn btn-reset" onclick="resetData()">🔄 重置为原始数据</button>
            <button class="control-btn btn-export" onclick="exportData()">📤 导出当前数据</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <table id="scheduleTable">
            <tbody><tr>
                <th>人员</th>
                <th>9.23</th>
                <th>9.24</th>
                <th>9.25</th>
                <th>9.26</th>
                <th>周末</th>
            </tr>
            <tr>
                <td class="name">倪</td>
                <td class="门 editable" data-person="倪" data-date="9.23">门</td>
                <td class="门 editable" data-person="倪" data-date="9.24">门上/门</td>
                <td class="门 editable" data-person="倪" data-date="9.25">门拖</td>
                <td class="门 editable" data-person="倪" data-date="9.26">门中</td>
                <td class="editable" data-person="倪" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">丽</td>
                <td class="门 editable" data-person="丽" data-date="9.23">门中</td>
                <td class="门 editable" data-person="丽" data-date="9.24">门</td>
                <td class="门 editable" data-person="丽" data-date="9.25">门/门下</td>
                <td class="门 editable" data-person="丽" data-date="9.26">门拖</td>
                <td class="editable" data-person="丽" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">方</td>
                <td class="门 editable" data-person="方" data-date="9.23">门拖</td>
                <td class="门 editable" data-person="方" data-date="9.24">门中</td>
                <td class="门 editable" data-person="方" data-date="9.25">门</td>
                <td class="门 editable" data-person="方" data-date="9.26">门上/门</td>
                <td class="editable" data-person="方" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">妍</td>
                <td class="门 editable" data-person="妍" data-date="9.23">门/门下</td>
                <td class="门 editable" data-person="妍" data-date="9.24">门拖</td>
                <td class="门 editable" data-person="妍" data-date="9.25">门中</td>
                <td class="门 editable" data-person="妍" data-date="9.26">门</td>
                <td class="editable" data-person="妍" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">秦</td>
                <td class="门库混合 editable" data-person="秦" data-date="9.23">门上/库</td>
                <td class="门库混合 editable" data-person="秦" data-date="9.24">库/门下</td>
                <td class="门库混合 editable" data-person="秦" data-date="9.25">门上/库</td>
                <td class="门库混合 editable" data-person="秦" data-date="9.26">库/门下</td>
                <td class="editable" data-person="秦" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">庆</td>
                <td class="库 editable" data-person="庆" data-date="9.23">库</td>
                <td class="库 editable" data-person="庆" data-date="9.24">库 08:30-10:00</td>
                <td class="库 editable" data-person="庆" data-date="9.25">库 13:30-15:00</td>
                <td class="库 editable" data-person="庆" data-date="9.26">库</td>
                <td class="editable" data-person="庆" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">瑾</td>
                <td class="机 editable" data-person="瑾" data-date="9.23">机（静）</td>
                <td class="静 editable" data-person="瑾" data-date="9.24">静 13:30-15:00</td>
                <td class="静 editable" data-person="瑾" data-date="9.25">静</td>
                <td class="静 editable" data-person="瑾" data-date="9.26">静 08:30-10:00</td>
                <td class="editable" data-person="瑾" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">全</td>
                <td class="静 editable" data-person="全" data-date="9.23">静</td>
                <td class="机 editable" data-person="全" data-date="9.24">机（静）</td>
                <td class="静 editable" data-person="全" data-date="9.25">静 10:00-11:30</td>
                <td class="静 editable" data-person="全" data-date="9.26">静</td>
                <td class="editable" data-person="全" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">荣</td>
                <td class="静 editable" data-person="荣" data-date="9.23">静 08:30-10:00</td>
                <td class="静 editable" data-person="荣" data-date="9.24">静</td>
                <td class="机 editable" data-person="荣" data-date="9.25">机（静）</td>
                <td class="静 editable" data-person="荣" data-date="9.26">静 10:00-11:30</td>
                <td class="editable" data-person="荣" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">斯</td>
                <td class="静 editable" data-person="斯" data-date="9.23">静 10:00-11:30</td>
                <td class="静 editable" data-person="斯" data-date="9.24">静</td>
                <td class="静 editable" data-person="斯" data-date="9.25">静</td>
                <td class="机 editable" data-person="斯" data-date="9.26">机（静）</td>
                <td class="editable" data-person="斯" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">顾</td>
                <td class="病 editable" data-person="顾" data-date="9.23">病</td>
                <td class="病 editable" data-person="顾" data-date="9.24">病 15:00-16:30</td>
                <td class="病 editable" data-person="顾" data-date="9.25">病</td>
                <td class="病 editable" data-person="顾" data-date="9.26">病 13:30-15:00</td>
                <td class="editable" data-person="顾" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">姚</td>
                <td class="病 editable" data-person="姚" data-date="9.23">病</td>
                <td class="病 editable" data-person="姚" data-date="9.24">病</td>
                <td class="病 editable" data-person="姚" data-date="9.25">病</td>
                <td class="病 editable" data-person="姚" data-date="9.26">病</td>
                <td class="editable" data-person="姚" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">辛</td>
                <td class="病 editable" data-person="辛" data-date="9.23">病 13:30-15:00</td>
                <td class="病 editable" data-person="辛" data-date="9.24">病</td>
                <td class="病 editable" data-person="辛" data-date="9.25">病</td>
                <td class="病 editable" data-person="辛" data-date="9.26">病 15:00-16:30</td>
                <td class="editable" data-person="辛" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">盼</td>
                <td class="病 editable" data-person="盼" data-date="9.23">病 15:00-16:30</td>
                <td class="病 editable" data-person="盼" data-date="9.24">病</td>
                <td class="病 editable" data-person="盼" data-date="9.25">病 08:30-10:00</td>
                <td class="病 editable" data-person="盼" data-date="9.26">病</td>
                <td class="editable" data-person="盼" data-date="周末">-</td>
            </tr>
            <tr>
                <td class="name">皓</td>
                <td class="库 editable" data-person="皓" data-date="9.23">库</td>
                <td class="库 editable" data-person="皓" data-date="9.24">库 10:00-11:30</td>
                <td class="库 editable" data-person="皓" data-date="9.25">库 15:00-16:30</td>
                <td class="库 editable" data-person="皓" data-date="9.26">库</td>
                <td class="editable" data-person="皓" data-date="周末">-</td>
            </tr>
            <!-- 预约休息行 -->
            <tr class="rest-row">
                <td class="rest-label">预约休息</td>
                <td class="editable" data-person="预约休息" data-date="9.23">-</td>
                <td class="editable" data-person="预约休息" data-date="9.24">-</td>
                <td class="editable" data-person="预约休息" data-date="9.25">-</td>
                <td class="editable" data-person="预约休息" data-date="9.26">-</td>
                <td class="editable" data-person="预约休息" data-date="周末">-</td>
            </tr>
        </tbody></table>
        
        <div class="tip">
            💡 点击任意班次可以编辑，所有修改会自动保存到本地<br>
            📝 刷新页面后修改内容仍然保持，可随时重置为原始数据<br>
            💾 数据存储在浏览器本地，不会丢失
        </div>
    </div>

    <!-- 确认对话框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">保存确认</div>
            <div class="modal-message">
                您确定要保存对<strong id="cellInfo"></strong>的修改吗？<br>
                新内容：<strong id="newContent"></strong>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="confirmSave()">✅ 保存</button>
                <button class="btn btn-secondary" onclick="cancelSave()">❌ 取消</button>
            </div>
        </div>
    </div>

    <script>
        // 获取所有可编辑单元格
        const editableCells = document.querySelectorAll('.editable');
        let currentlyEditing = null;
        let pendingEdit = null;
        const STORAGE_KEY = 'schedule_data';
        
        // 原始数据存储
        const originalData = {};
        
        // 保存原始数据
        function saveOriginalData() {
            editableCells.forEach(cell => {
                const key = `${cell.dataset.person}-${cell.dataset.date}`;
                originalData[key] = cell.textContent.trim();
            });
        }
        
        // 显示状态信息
        function showStatus(message, duration = 2000) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            setTimeout(() => {
                statusEl.textContent = '';
            }, duration);
        }
        
        // 保存数据到本地存储
        function saveToLocalStorage() {
            const data = {};
            editableCells.forEach(cell => {
                const key = `${cell.dataset.person}-${cell.dataset.date}`;
                data[key] = cell.textContent.trim();
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            showStatus('✅ 数据已保存');
        }
        
        // 从本地存储加载数据
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    let hasChanges = false;
                    
                    editableCells.forEach(cell => {
                        const key = `${cell.dataset.person}-${cell.dataset.date}`;
                        if (data[key] !== undefined) {
                            cell.textContent = data[key];
                            applyStyle(cell, data[key]);
                            hasChanges = true;
                        }
                    });
                    
                    if (hasChanges) {
                        showStatus('📋 已加载保存的数据', 3000);
                    }
                }
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }
        
        // 重置为原始数据
        function resetData() {
            if (confirm('确定要重置为原始数据吗？所有修改将丢失！')) {
                editableCells.forEach(cell => {
                    const key = `${cell.dataset.person}-${cell.dataset.date}`;
                    if (originalData[key] !== undefined) {
                        cell.textContent = originalData[key];
                        applyStyle(cell, originalData[key]);
                    }
                });
                localStorage.removeItem(STORAGE_KEY);
                showStatus('🔄 已重置为原始数据');
            }
        }
        
        // 导出当前数据
        function exportData() {
            const data = {};
            editableCells.forEach(cell => {
                const key = `${cell.dataset.person}-${cell.dataset.date}`;
                data[key] = cell.textContent.trim();
            });
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `排班表数据_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('📤 数据导出成功');
        }
        
        // 自动应用样式
        function applyStyle(cell, text) {
            // 移除所有样式类
            cell.classList.remove('门', '库', '静', '病', '机', '休', '换', '门库混合');
            
            const content = text.toLowerCase();
            
            if (content.includes('休')) {
                cell.classList.add('休');
            } else if (content.includes('换')) {
                cell.classList.add('换');
            } else if (content.includes('门') && content.includes('库')) {
                cell.classList.add('门库混合');
            } else if (content.includes('门')) {
                cell.classList.add('门');
            } else if (content.includes('库')) {
                cell.classList.add('库');
            } else if (content.includes('静')) {
                cell.classList.add('静');
            } else if (content.includes('病')) {
                cell.classList.add('病');
            } else if (content.includes('机')) {
                cell.classList.add('机');
            }
        }
        
        // 获取单元格位置信息
        function getCellInfo(cell) {
            return `${cell.dataset.person} - ${cell.dataset.date}`;
        }
        
        // 显示确认对话框
        function showConfirmDialog(cell, originalText, newText) {
            const cellInfo = getCellInfo(cell);
            document.getElementById('cellInfo').textContent = cellInfo;
            document.getElementById('newContent').textContent = newText || '-';
            document.getElementById('confirmModal').style.display = 'block';
            
            // 存储待处理的编辑信息
            pendingEdit = {
                cell: cell,
                originalText: originalText,
                newText: newText
            };
        }
        
        // 确认保存
        function confirmSave() {
            if (pendingEdit) {
                const { cell, newText } = pendingEdit;
                
                if (newText === '') {
                    cell.textContent = '-';
                } else {
                    cell.textContent = newText;
                }
                
                // 应用样式
                applyStyle(cell, newText);
                
                // 保存到本地存储
                saveToLocalStorage();
                
                // 清理
                pendingEdit = null;
                currentlyEditing = null;
            }
            
            // 隐藏对话框
            document.getElementById('confirmModal').style.display = 'none';
        }
        
        // 取消保存
        function cancelSave() {
            if (pendingEdit) {
                const { cell, originalText } = pendingEdit;
                
                // 恢复原始内容
                cell.textContent = originalText;
                
                // 重新应用原有样式
                applyStyle(cell, originalText);
                
                // 清理
                pendingEdit = null;
                currentlyEditing = null;
            }
            
            // 隐藏对话框
            document.getElementById('confirmModal').style.display = 'none';
        }
        
        // 开始编辑
        function startEdit(cell) {
            if (currentlyEditing) return;
            
            currentlyEditing = cell;
            const originalText = cell.textContent.trim();
            
            // 创建输入框
            const input = document.createElement('textarea');
            input.className = 'edit-input';
            input.value = originalText === '-' ? '' : originalText;
            
            // 清空单元格并添加输入框
            cell.innerHTML = '';
            cell.appendChild(input);
            
            // 聚焦并选中文本
            input.focus();
            input.select();
            
            // 保存编辑（显示确认对话框）
            function saveEdit() {
                const newText = input.value.trim();
                
                // 如果内容没有变化，直接取消编辑
                if (newText === originalText || (newText === '' && originalText === '-')) {
                    cancelEdit();
                    return;
                }
                
                // 显示确认对话框
                showConfirmDialog(cell, originalText, newText);
            }
            
            // 取消编辑
            function cancelEdit() {
                currentlyEditing = null;
                cell.textContent = originalText;
                
                // 重新应用原有样式
                applyStyle(cell, originalText);
            }
            
            // 事件监听
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });
        }
        
        // 为所有可编辑单元格添加点击事件
        editableCells.forEach(cell => {
            cell.addEventListener('click', function(e) {
                e.preventDefault();
                startEdit(this);
            });
        });
        
        // 点击模态框背景关闭
        document.getElementById('confirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelSave();
            }
        });
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 保存原始数据
            saveOriginalData();
            
            // 加载保存的数据
            loadFromLocalStorage();
        });
    </script>


</body></html>